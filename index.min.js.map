{"version":3,"file":"index.min.js","sources":["src/h/index.js","src/binding/index.js","src/patch/index.js","src/style/index.js","src/animation/index.js"],"sourcesContent":["export function h (...args) {\n  if (!isProps(args[1])) {\n    args.splice(1, 0, {})\n  }\n  let element = document.createElement(args[0])\n  for (let name in args[1]) {\n    let value = args[1][name]\n    if (/^(checked|disabled|selected)$/.test(name)) {\n      if (value) {\n        element.setAttribute(name, '')\n      }\n    } else if (/^on/.test(name) && typeof value === 'function') {\n      element.setAttribute(name, '//' + ++count)\n      element[name] = function (event) {\n        value(event)\n        dispatchEvent(new Event('h'))\n      }\n    } else {\n      element.setAttribute(name, value)\n    }\n  }\n  append(element, args.slice(2))\n  return element\n}\n\nexport function append (parent, children) {\n  for (let child of children) {\n    if (Array.isArray(child)) {\n      append(parent, child)\n    } else if (child instanceof Node) {\n      parent.appendChild(child)\n    } else {\n      parent.appendChild(document.createTextNode(child ?? ''))\n    }\n  }\n}\n\nexport function div (...args) {\n  return h('div', ...args)\n}\n\nexport function span (...args) {\n  return h('span', ...args)\n}\n\nexport function p (...args) {\n  return h('p', ...args)\n}\n\nexport function br (...args) {\n  return h('br', ...args)\n}\n\nexport function b (...args) {\n  return h('b', ...args)\n}\n\nexport function i (...args) {\n  return h('i', ...args)\n}\n\nexport function u (...args) {\n  return h('u', ...args)\n}\n\nexport function form (...args) {\n  return h('form', ...args)\n}\n\nexport function label (...args) {\n  return h('label', ...args)\n}\n\nexport function textarea (...args) {\n  return h('textarea', ...args)\n}\n\nexport function select (...args) {\n  return h('select', ...args)\n}\n\nexport function input (...args) {\n  return h('input', ...args)\n}\n\nexport function button (...args) {\n  return h('button', ...args)\n}\n\nexport function img (...args) {\n  return h('img', ...args)\n}\n\nexport function table (...args) {\n  return h('table', ...args)\n}\n\nexport function thead (...args) {\n  return h('thead', ...args)\n}\n\nexport function tr (...args) {\n  return h('tr', ...args)\n}\n\nexport function th (...args) {\n  return h('th', ...args)\n}\n\nexport function td (...args) {\n  return h('td', ...args)\n}\n\nlet count = 0\n\nfunction isProps (value) {\n  return typeof value === 'object'\n    && value !== null\n    && value.constructor === Object\n}\n","export function bind (root, render) {\n  ready(function () {\n    if (typeof root === 'string') {\n      root = document.querySelector(root)\n    }\n    if (!bindings) {\n      bindings = new Map()\n    }\n    bindings = new Map(bindings).set(root, render)\n    update()\n  })\n}\n\nexport function unbind (node) {\n  while (node !== document) {\n    if (bindings.has(node)) {\n      bindings = new Map(bindings)\n      bindings.delete(node)\n      break\n    }\n    node = node.parentNode\n  }\n}\n\nexport function update () {\n  cancelAnimationFrame(frame)\n  frame = requestAnimationFrame(function () {\n    for (let [root, render] of bindings.entries()) {\n      let next = root.cloneNode()\n      append(next, [render()])\n      patch(root, next)\n    }\n  })\n}\n\nimport { append } from '../h/index.js'\nimport { patch } from '../patch/index.js'\n\nlet bindings\nlet frame\n\naddEventListener('h', update)\n\nfunction ready (callback) {\n  if (document.readyState !== 'loading') {\n    callback()\n  } else {\n    addEventListener('DOMContentLoaded', callback)\n  }\n}\n","export function patch (previous, next) {\n  if (!previous.isEqualNode(next)) {\n    if (previous.nodeName !== next.nodeName) {\n      previous.parentNode.replaceChild(next, previous)\n    } else if (previous.nodeType === Node.TEXT_NODE) {\n      if (previous.textContent !== next.textContent) {\n        previous.textContent = next.textContent\n      }\n    } else if (previous.nodeType === Node.ELEMENT_NODE) {\n      for (let { name, value } of next.attributes) {\n        if (previous.getAttribute(name) !== value) {\n          previous.setAttribute(name, value)\n          if (/^on/.test(name)) {\n            previous[name] = next[name]\n          }\n        }\n      }\n      for (let { name } of [...previous.attributes]) {\n        if (!next.hasAttribute(name)) {\n          previous.removeAttribute(name)\n        }\n      }\n      let nodesA = [...previous.childNodes]\n      let nodesB = [...next.childNodes]\n      let a = nodesA.length\n      let b = nodesB.length\n      if (a < b) {\n        for (let i = a; i < b; i++) {\n          previous.appendChild(nodesB[i])\n        }\n      } else if (b < a) {\n        for (let i = b; i < a; i++) {\n          previous.removeChild(nodesA[i])\n        }\n      }\n      let c = Math.min(a, b)\n      for (let i = 0; i < c; i++) {\n        patch(nodesA[i], nodesB[i])\n      }\n    }\n  }\n}\n","export function style (object) {\n  let styles = {}\n  let rules = ''\n  for (let name in object) {\n    let declaration = object[name]\n    let rule = '.' + (styles[name] = 's' + ++count) + '{'\n    for (let key in declaration) {\n      let value = declaration[key]\n      if (typeof value === 'object') {\n        let sub = '.' + styles[name] + ':' + key + '{'\n        for (let subKey in value) {\n          sub += propify(subKey, value[subKey])\n        }\n        sub += '}'\n        rules += sub\n      } else {\n        rule += propify(key, value)\n      }\n    }\n    rule += '}'\n    rules += rule\n  }\n  document.head.appendChild(\n    Object.assign(\n      document.createElement('style'),\n      { textContent: rules }\n    )\n  )\n  return styles\n}\n\nlet count = 0\n\nfunction propify (key, value) {\n  return key.replace(/[A-Z]/g, '-$&') + ':' + value + ';'\n}\n","export function animation (object) {\n  let animations = {}\n  let css = ''\n  for (let name in object) {\n    let block = object[name]\n    css += '@keyframes ' + (animations[name] = 'k' + ++count) + '{'\n    for (let step in block) {\n      let declaration = block[step]\n      if (step === 'from' || step === 'to') {\n        css += step\n      } else {\n        css += step + '%'\n      }\n      css += '{'\n      for (let key in declaration) {\n        css += propify(key, declaration[key])\n      }\n      css += '}'\n    }\n    css += '}'\n  }\n  document.head.appendChild(\n    Object.assign(\n      document.createElement('style'),\n      { textContent: css }\n    )\n  )\n  return animations\n}\n\nlet count = 0\n\nfunction propify (key, value) {\n  return key.replace(/[A-Z]/g, '-$&') + ':' + value + ';'\n}\n"],"names":["h","args","value","constructor","Object","splice","element","document","createElement","name","test","setAttribute","count","event","dispatchEvent","Event","append","slice","parent","children","child","Array","isArray","Node","appendChild","createTextNode","div","span","p","br","b","i","u","form","label","textarea","select","input","button","img","table","thead","tr","th","td","bindings","frame","patch","previous","next","isEqualNode","nodeName","parentNode","replaceChild","nodeType","TEXT_NODE","textContent","ELEMENT_NODE","attributes","getAttribute","hasAttribute","removeAttribute","nodesA","childNodes","nodesB","a","length","removeChild","c","Math","min","bind","root","render","callback","querySelector","Map","set","update","readyState","addEventListener","unbind","node","has","delete","cancelAnimationFrame","requestAnimationFrame","entries","cloneNode","style","object","styles","rules","declaration","rule","key","sub","subKey","propify","head","assign","replace","animation","animations","css","block","step"],"mappings":"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"}